

<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>æ²³å·çµã‚Šè¾¼ã¿ãƒãƒƒãƒ—</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
  <style>
    body, html { height: 100%; margin: 0; }
    #map { height: 100%; }
    #controlPanel {
      position: fixed;
      top: 10px;
      right: 10px;
      z-index: 1001;
      background: white;
      padding: 10px;
      border-radius: 5px;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
    }
    #filterPanel, #colorPanel {
      display: none;
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      padding: 20px;
      color: white;
    }
    .panelContent {
      background: white; color: black; padding: 15px;
      max-width: 400px; margin: auto; border-radius: 10px;
    }
    #locationButton { position: fixed; bottom: 10px; right: 10px; z-index: 1001; }
  </style>
</head>

<body>
<div id="map"></div>

<div id="controlPanel">
  <button onclick="toggleFilterPanel()">çµã‚Šè¾¼ã¿</button>
  <button onclick="toggleColorPanel()">ç€è‰²æ–¹æ³•ã‚’å¤‰æ›´</button>
  <button onclick="resetAll()">å…¨æ²³å·è¡¨ç¤º</button>
</div>

<div id="filterPanel">
  <div class="panelContent">
    <h3>æ²³å·çµã‚Šè¾¼ã¿</h3>
    <div>
      <label>æ²³å·å</label><br>
      <input type="checkbox" value="é‰„ç ²æ´²å·"> é‰„ç ²æ´²å·<br>
      <input type="checkbox" value="å…¥èˆ¹å·"> å…¥èˆ¹å·<br>
      <!-- ä»–ã®æ²³å·ã®ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’è¿½åŠ  -->
    </div>
    <div>
      <label>åŸ‹ã‚ç«‹ã¦æ™‚æœŸ</label><br>
      <select id="burialPeriod" multiple>
        <option value="éœ‡ç½å¾©èˆˆ">éœ‡ç½å¾©èˆˆ</option>
        <option value="æˆ¦ç½å¾©èˆˆ">æˆ¦ç½å¾©èˆˆ</option>
        <option value="æ±äº¬ã‚ªãƒªãƒ³ãƒ”ãƒƒã‚¯">æ±äº¬ã‚ªãƒªãƒ³ãƒ”ãƒƒã‚¯</option>
        <option value="ãã®ä»–">ãã®ä»–</option>
      </select>
    </div>
    <button onclick="applyFilter()">çµã‚Šè¾¼ã¿é©ç”¨</button>
    <button onclick="resetFilter()">çµã‚Šè¾¼ã¿ãƒªã‚»ãƒƒãƒˆ</button>
    <button onclick="closeFilter()">é–‰ã˜ã‚‹</button>
  </div>
</div>

<div id="colorPanel">
  <div class="panelContent">
    <h3>ç€è‰²æ–¹æ³•ã‚’é¸æŠ</h3>
    <label><input type="checkbox" id="singleColor" onclick="applyColorScheme()"> å˜è‰²è¡¨ç¤º</label><br>
    <label><input type="checkbox" id="colorByTime" onclick="applyColorScheme()"> åŸ‹ã‚ç«‹ã¦æ™‚æœŸã§è‰²åˆ†ã‘</label><br>
    <button onclick="closeColorPanel()">é–‰ã˜ã‚‹</button>
  </div>
</div>

<button id="locationButton" onclick="getLocation()">ğŸ“</button>

<script>
var map = L.map('map').setView([35.667547, 139.775105], 14);
L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/pale/{z}/{x}/{y}.png').addTo(map);

function toggleFilterPanel() {
  const panel = document.getElementById('filterPanel');
  panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
}
function closeFilter() {
  document.getElementById('filterPanel').style.display = 'none';
}

function toggleColorPanel() {
  const panel = document.getElementById('colorPanel');
  panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
}
function closeColorPanel() {
  document.getElementById('colorPanel').style.display = 'none';
}

let geoJsonLayer;
fetch('https://raw.githubusercontent.com/sirabesilmoon/riv/main/ChuoRiver.geojson')
  .then(response => response.json())
  .then(data => {
    geoJsonLayer = L.geoJSON(data, {
      style: { color: 'blue', weight: 1 },
      onEachFeature: (feature, layer) => {
        layer.bindPopup(`<b>æ²³å·å:</b> ${feature.properties.name}<br>
                         <b>åŸ‹ã‚ç«‹ã¦æ™‚æœŸ:</b> ${feature.properties.time}<br>
                         <button onclick="walkRiver('${feature.properties.name}')">ã“ã®æ²³å·ã‚’æ­©ã</button>`);
        
        // ã‚¯ãƒªãƒƒã‚¯ã§é¸æŠã€ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã§è§£é™¤
        layer.on('click', function() {
          layer.setStyle({ color: 'yellow' });
        });
        
        layer.on('dblclick', function() {
          layer.setStyle({ color: getColorByTime(feature.properties.time) });
          layer.closePopup();
        });
      }
    }).addTo(map);
  })
  .catch(console.error);

// è‰²åˆ†ã‘é©ç”¨
function applyColorScheme() {
  geoJsonLayer.eachLayer(layer => {
    if (document.getElementById('colorByTime').checked) {
      layer.setStyle({ color: getColorByTime(layer.feature.properties.time) });
    } else if (document.getElementById('singleColor').checked) {
      layer.setStyle({ color: 'blue' });
    } else {
      layer.setStyle({ color: 'blue' });
    }
  });
}

function getColorByTime(time) {
  switch(time) {
    case 'éœ‡ç½å¾©èˆˆ': return 'red';
    case 'æˆ¦ç½å¾©èˆˆ': return 'purple';
    case 'æ±äº¬ã‚ªãƒªãƒ³ãƒ”ãƒƒã‚¯': return 'blue';
    default: return 'orange';
  }
}

// çµã‚Šè¾¼ã¿ã€ãƒªã‚»ãƒƒãƒˆã€å…¨æ²³å·è¡¨ç¤ºãªã©ã®ä»–ã®é–¢æ•°
function applyFilter() { /* ... */ }
function resetFilter() { /* ... */ }
function resetAll() { /* ... */ }

// ä½ç½®æƒ…å ±å–å¾—ãªã©ã®ä»–ã®é–¢æ•°
function getLocation() { /* ... */ }
</script>
</body>
</html>
