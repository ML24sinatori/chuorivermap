

<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>河川絞り込みマップ</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
  <style>
    body, html { height: 100%; margin: 0; }
    #map { height: 100%; }
    #controlPanel {
      position: fixed;
      top: 10px;
      right: 10px;
      z-index: 1001;
      background: white;
      padding: 10px;
      border-radius: 5px;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
    }
    #filterPanel, #colorPanel {
      display: none;
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      padding: 20px;
      color: white;
    }
    .panelContent {
      background: white; color: black; padding: 15px;
      max-width: 400px; margin: auto; border-radius: 10px;
    }
    #locationButton { position: fixed; bottom: 10px; right: 10px; z-index: 1001; }
  </style>
</head>

<body>
<div id="map"></div>

<div id="controlPanel">
  <button onclick="toggleFilterPanel()">絞り込み</button>
  <button onclick="toggleColorPanel()">着色方法を変更</button>
  <button onclick="resetAll()">全河川表示</button>
</div>

<div id="filterPanel">
  <div class="panelContent">
    <h3>河川絞り込み</h3>
    <div>
      <label>河川名</label><br>
      <input type="checkbox" value="鉄砲洲川"> 鉄砲洲川<br>
      <input type="checkbox" value="入船川"> 入船川<br>
      <!-- 他の河川のチェックボックスを追加 -->
    </div>
    <div>
      <label>埋め立て時期</label><br>
      <select id="burialPeriod" multiple>
        <option value="震災復興">震災復興</option>
        <option value="戦災復興">戦災復興</option>
        <option value="東京オリンピック">東京オリンピック</option>
        <option value="その他">その他</option>
      </select>
    </div>
    <button onclick="applyFilter()">絞り込み適用</button>
    <button onclick="resetFilter()">絞り込みリセット</button>
    <button onclick="closeFilter()">閉じる</button>
  </div>
</div>

<div id="colorPanel">
  <div class="panelContent">
    <h3>着色方法を選択</h3>
    <label><input type="checkbox" id="singleColor" onclick="applyColorScheme()"> 単色表示</label><br>
    <label><input type="checkbox" id="colorByTime" onclick="applyColorScheme()"> 埋め立て時期で色分け</label><br>
    <button onclick="closeColorPanel()">閉じる</button>
  </div>
</div>

<button id="locationButton" onclick="getLocation()">📍</button>

<script>
var map = L.map('map').setView([35.667547, 139.775105], 14);
L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/pale/{z}/{x}/{y}.png').addTo(map);

function toggleFilterPanel() {
  const panel = document.getElementById('filterPanel');
  panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
}
function closeFilter() {
  document.getElementById('filterPanel').style.display = 'none';
}

function toggleColorPanel() {
  const panel = document.getElementById('colorPanel');
  panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
}
function closeColorPanel() {
  document.getElementById('colorPanel').style.display = 'none';
}

let geoJsonLayer;
fetch('https://raw.githubusercontent.com/sirabesilmoon/riv/main/ChuoRiver.geojson')
  .then(response => response.json())
  .then(data => {
    geoJsonLayer = L.geoJSON(data, {
      style: { color: 'blue', weight: 1 },
      onEachFeature: (feature, layer) => {
        layer.bindPopup(`<b>河川名:</b> ${feature.properties.name}<br>
                         <b>埋め立て時期:</b> ${feature.properties.time}<br>
                         <button onclick="walkRiver('${feature.properties.name}')">この河川を歩く</button>`);
        
        // クリックで選択、ダブルクリックで解除
        layer.on('click', function() {
          layer.setStyle({ color: 'yellow' });
        });
        
        layer.on('dblclick', function() {
          layer.setStyle({ color: getColorByTime(feature.properties.time) });
          layer.closePopup();
        });
      }
    }).addTo(map);
  })
  .catch(console.error);

// 色分け適用
function applyColorScheme() {
  geoJsonLayer.eachLayer(layer => {
    if (document.getElementById('colorByTime').checked) {
      layer.setStyle({ color: getColorByTime(layer.feature.properties.time) });
    } else if (document.getElementById('singleColor').checked) {
      layer.setStyle({ color: 'blue' });
    } else {
      layer.setStyle({ color: 'blue' });
    }
  });
}

function getColorByTime(time) {
  switch(time) {
    case '震災復興': return 'red';
    case '戦災復興': return 'purple';
    case '東京オリンピック': return 'blue';
    default: return 'orange';
  }
}

// 絞り込み、リセット、全河川表示などの他の関数
function applyFilter() { /* ... */ }
function resetFilter() { /* ... */ }
function resetAll() { /* ... */ }

// 位置情報取得などの他の関数
function getLocation() { /* ... */ }
</script>
</body>
</html>
